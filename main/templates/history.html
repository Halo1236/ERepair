<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="telephone=no" name="format-detection"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>我的历史工单</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="//cdn.bootcss.com/weui/1.1.1/style/weui.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/title.css') }}"/>
    <link rel="stylesheet" href="//cdn.bootcss.com/jquery-weui/1.0.0/css/jquery-weui.min.css">
</head>
<body ontouchstart>
<div class="hd">
    <h1 class="page_title">{{ page_title }}</h1>
    <p class="page_desc">
        <span>
            {{ page_info }}<a class="wo_btn" href="{{ url_for('log_out') }}">点击我退出</a>
        </span>
    </p>
</div>
{% if content !=None %}
    {% for wo in content %}
        {% if wo.ishandle == 0 %}
            <div class="weui-form-preview">
                <div class="weui-form-preview__hd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">工单状态</label>
                        <em class="weui-form-preview__value">未处理</em>
                    </div>
                </div>
                <div class="weui-form-preview__bd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">工单编号</label>
                        <span class="weui-form-preview__value">{{ wo.id }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">手机号码</label>
                        <span class="weui-form-preview__value">{{ wo.tel_number }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">提交时间</label>
                        <span class="weui-form-preview__value">{{ wo.regtime }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">电脑品牌</label>
                        <span class="weui-form-preview__value">{{ wo.brand }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">服务选择</label>
                        <span class="weui-form-preview__value">{{ wo.problem }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">预约时间</label>
                        <span class="weui-form-preview__value">{{ wo.scheduled }}</span>
                    </div>
                </div>
                <div class="weui-form-preview__ft">
                    <a class="weui-form-preview__btn weui-form-preview__btn_primary"
                       onclick="canceled({{ wo.id }})">取消预约</a>
                </div>
            </div>
            <br>
        {% elif wo.ishandle == 1 %}
            <div class="weui-form-preview">
                <div class="weui-form-preview__hd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">工单状态</label>
                        <em class="weui-form-preview__value">已处理</em>
                    </div>
                </div>
                <div class="weui-form-preview__bd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">工单编号</label>
                        <span class="weui-form-preview__value">{{ wo.id }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">手机号码</label>
                        <span class="weui-form-preview__value">{{ wo.tel_number }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">提交时间</label>
                        <span class="weui-form-preview__value">{{ wo.regtime }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">电脑品牌</label>
                        <span class="weui-form-preview__value">{{ wo.brand }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">服务选择</label>
                        <span class="weui-form-preview__value">{{ wo.problem }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">预约时间</label>
                        <span class="weui-form-preview__value">{{ wo.scheduled }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">S/N码</label>
                        <span class="weui-form-preview__value">{{ wo.sn }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">维修人员姓名</label>
                        <span class="weui-form-preview__value">{{ wo.admin_name }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">维修人员留言</label>
                        <span class="weui-form-preview__value">{{ wo.admin_remark }}</span>
                    </div>
                </div>
                <div class="weui-form-preview__ft">
                    <a class="weui-form-preview__btn weui-form-preview__btn_primary"
                       onclick="confirmed({{ wo.id }})">确认评价</a>
                </div>
            </div>
            <br>
        {% elif wo.ishandle == 2 %}
            <div class="weui-form-preview">
                <div class="weui-form-preview__hd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">工单状态</label>
                        <em class="weui-form-preview__value">已完成</em>
                    </div>
                </div>
                <div class="weui-form-preview__bd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">工单编号</label>
                        <span class="weui-form-preview__value">{{ wo.id }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">手机号码</label>
                        <span class="weui-form-preview__value">{{ wo.tel_number }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">提交时间</label>
                        <span class="weui-form-preview__value">{{ wo.regtime }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">电脑品牌</label>
                        <span class="weui-form-preview__value">{{ wo.brand }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">服务选择</label>
                        <span class="weui-form-preview__value">{{ wo.problem }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">预约时间</label>
                        <span class="weui-form-preview__value">{{ wo.scheduled }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">S/N码</label>
                        <span class="weui-form-preview__value">{{ wo.sn }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">维修人员姓名</label>
                        <span class="weui-form-preview__value">{{ wo.admin_name }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">维修人员留言</label>
                        <span class="weui-form-preview__value">{{ wo.admin_remark }}</span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">维修评价</label>
                        <span class="weui-form-preview__value">{{ wo.evaluation }}</span>
                    </div>
                </div>
            </div>
            <br>
        {% endif %}
    {%- endfor %}
{% else %}
    <div class="weui-msg">
        <div class="weui-msg__icon-area">
            <i class="weui-icon-warn weui-icon_msg-primary"></i>
        </div>
        <div class="weui-msg__text-area">
            <h2 class="weui-msg__title">历史工单为空</h2>
        </div>
    </div>
{% endif %}

<script src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
<script src="//cdn.bootcss.com/jquery-weui/1.0.0/js/jquery-weui.min.js"></script>
<script>
    $(function () {
        FastClick.attach(document.body);
    });

    function canceled(wo_id) {
        $.confirm("您确定要取消工单编号为 " + wo_id + " 的工单吗?", "确认取消?", function () {
            $.post(window.location.href, {wo_id: wo_id, wo_ishandle: 3}, function (res) {
                if (res.errmsg == 'ok') {
                    setTimeout(function () {
                        window.location.href = window.location.href;
                    }, 500);
                }
            });
        }, function () {
            //取消操作
        });
    }

    function confirmed(wo_id) {
        $.prompt("1-5分请您打分评价", "确认评价", function (text) {
            $.post(window.location.href, {wo_id: wo_id, wo_evaluation: text}, function (res) {
                if (res.errmsg == 'ok') {
                    setTimeout(function () {
                        window.location.href = window.location.href;
                    }, 500);
                }
            });
        }, function () {
            //点击取消后的回调函数
        });
    }
</script>
</body>
</html>